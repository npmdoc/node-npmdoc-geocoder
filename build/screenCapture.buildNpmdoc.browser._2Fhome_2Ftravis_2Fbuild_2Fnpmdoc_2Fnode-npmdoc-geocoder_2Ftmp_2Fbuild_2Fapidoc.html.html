<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/wyattdanger/geocoder">geocoder (v0.2.3)</a>
</h1>
<h4>node wrapper around google's geocoder api</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.geocoder">module geocoder</a><ol>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">geocoder.</span>geonames</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">geocoder.</span>providerObj</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">geocoder.</span>providerOpts</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">geocoder.</span>yahoo</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">string <span class="apidocSignatureSpan">geocoder.</span>provider</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.geocoder.geonames">module geocoder.geonames</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.geonames.geocode">
            function <span class="apidocSignatureSpan">geocoder.geonames.</span>geocode
            <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.geonames.reverseGeocode">
            function <span class="apidocSignatureSpan">geocoder.geonames.</span>reverseGeocode
            <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.geocoder.providerObj">module geocoder.providerObj</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.providerObj.geocode">
            function <span class="apidocSignatureSpan">geocoder.providerObj.</span>geocode
            <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.providerObj.reverseGeocode">
            function <span class="apidocSignatureSpan">geocoder.providerObj.</span>reverseGeocode
            <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.geocoder.yahoo">module geocoder.yahoo</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.yahoo.geocode">
            function <span class="apidocSignatureSpan">geocoder.yahoo.</span>geocode
            <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.geocoder.yahoo.reverseGeocode">
            function <span class="apidocSignatureSpan">geocoder.yahoo.</span>reverseGeocode
            <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.geocoder" id="apidoc.module.geocoder">module geocoder</a></h1>











</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.geocoder.geonames" id="apidoc.module.geocoder.geonames">module geocoder.geonames</a></h1>


    <h2>
        <a href="#apidoc.element.geocoder.geonames.geocode" id="apidoc.element.geocoder.geonames.geocode">
        function <span class="apidocSignatureSpan">geocoder.geonames.</span>geocode
        <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">geocode = function ( providerOpts, loc, cbk, opts ) {

  var options = _.extend({q: loc, maxRows: 10, username:providerOpts.username||"demo" }, opts || {});

  request({
    uri:"http://api.geonames.org/searchJSON",
    qs:options
  }, function(err,resp,body) {
    if (err) return cbk(err);
    var result;
    try {
      result = JSON.parse(body);
    } catch (err) {
      cbk(err);
      return;
    }
    cbk(null,result);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

###Example:

```javascript
var geocoder = require('geocoder');

// Geocoding
geocoder.<span class="apidocCodeKeywordSpan">geocode</span>("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.geocoder.geonames.reverseGeocode" id="apidoc.element.geocoder.geonames.reverseGeocode">
        function <span class="apidocSignatureSpan">geocoder.geonames.</span>reverseGeocode
        <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reverseGeocode = function ( providerOpts, lat, lng, cbk, opts ) {

  var options = _.extend({lat:lat, lng:lng, username:providerOpts.username||"demo" }, opts || {});

  request({
    uri:"http://api.geonames.org/extendedFindNearby",
    qs:options
  }, function(err,resp,body) {
    if (err) return cbk(err);

    var parser = new xml2js.Parser();
    parser.parseString(body, function (err, result) {
      if (err) return cbk(err);

      // Transform geonames' structure into something that looks like Google's JSON outpu
      // https://developers.google.com/maps/documentation/geocoding/#JSON
      var googlejson = {
        "status":"OK",
        "results":[
          {
            "address_components":[],
            "formatted_address":"",
            "geometry":{
              "location":{
                "lat":lat,
                "lng":lng
              }
            }
          }
        ]
      };

      if (result.geonames.address) {
        var a = result.geonames.address[0];

        if (a.streetNumber &amp;&amp; typeof a.streetNumber[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.streetNumber[0],
            "short_name":a.streetNumber[0],
            "types":["street_number"]
          });

        if (a.street &amp;&amp; typeof a.street[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.street[0],
            "short_name":a.street[0],
            "types":["route"]
          });

        if (a.placename &amp;&amp; typeof a.placename[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.placename[0],
            "short_name":a.placename[0],
            "types":["locality", "political"]
          });

        if (a.adminName1 &amp;&amp; typeof a.adminName1[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.adminName1[0],
            "short_name":a.adminCode1[0],
            "types":[ "administrative_area_level_1", "political" ]
          });

        if (a.adminName2 &amp;&amp; typeof a.adminName2[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.adminName2[0],
            "short_name":a.adminCode2[0],
            "types":[ "administrative_area_level_2", "political" ]
          });

        if (a.countryCode &amp;&amp; typeof a.countryCode[0]=="string")
          googlejson.results[0].address_components.push({
            "long_name":a.countryCode[0]=="US"?"United States":"",
            "short_name":a.countryCode[0],
            "types":[ "country" ]
          });

        if (a.lat &amp;&amp; typeof a.lat[0]=="string")
          googlejson.results[0].geometry.location = {
            "lat":parseFloat(a.lat[0]),
            "lng":parseFloat(a.lng[0])
          }
      }

      if (result.geonames.geoname) {
        // http://www.geonames.org/export/codes.html
        // https://developers.google.com/maps/documentation/geocoding/#Types
        var fcode2google = {
          "ADM1":[ "administrative_area_level_1", "political" ],
          "ADM2":[ "administrative_area_level_2", "political" ],
          "ADM3":[ "administrative_area_level_3", "political" ],
          "ADMD":[ "political"],
          "PPL" :[ "locality"]
        };

        result.geonames.geoname.forEach(function(geoname) {

          // Push only recognized types to results
          if (geoname.fcode[0]=="PCLI") {
            googlejson.results[0].address_components.push({
              "long_name":geoname.name[0],
              "short_name":geoname.countryCode[0],
              "types":[ "country", "political"]
            });

          } else if (fcode2google[geoname.fcode[0]]) {


            googlejson.results[0].address_components.push({
              "long_name":geoname.toponymName[0],
              "short_name":geoname.name[0],
              "types":fcode2google[geoname.fcode[0]]
            });
          }

        });
      }

      // Make a formatted address as well as we can
      var shortNames = {};
      googlejson.results[0].address_components.forEach(func ...</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Geocoding
geocoder.geocode("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.<span class="apidocCodeKeywordSpan">reverseGeocode</span>( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});

// Setting sensor to true
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
}, { sensor: true });
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.geocoder.providerObj" id="apidoc.module.geocoder.providerObj">module geocoder.providerObj</a></h1>


    <h2>
        <a href="#apidoc.element.geocoder.providerObj.geocode" id="apidoc.element.geocoder.providerObj.geocode">
        function <span class="apidocSignatureSpan">geocoder.providerObj.</span>geocode
        <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">geocode = function ( providerOpts, loc, cbk, opts ) {

  var options = _.extend({sensor: false, address: loc}, opts || {});
  var uri = "http" + ( options.key ? "s" : "" ) + "://maps.googleapis.com/maps/api/geocode/json"
  request({
    uri: uri,
    qs:options
  }, function(err,resp,body) {
    if (err) return cbk(err);
    var result;
    try {
      result = JSON.parse(body);
    } catch (err) {
      cbk(err);
      return;
    }
    cbk(null,result);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

###Example:

```javascript
var geocoder = require('geocoder');

// Geocoding
geocoder.<span class="apidocCodeKeywordSpan">geocode</span>("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.geocoder.providerObj.reverseGeocode" id="apidoc.element.geocoder.providerObj.reverseGeocode">
        function <span class="apidocSignatureSpan">geocoder.providerObj.</span>reverseGeocode
        <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reverseGeocode = function ( providerOpts, lat, lng, cbk, opts ) {

  var options = _.extend({sensor: false, latlng: lat + ',' + lng}, opts || {});
  var uri = "http" + ( options.key ? "s" : "" ) + "://maps.googleapis.com/maps/api/geocode/json"

  request({
    uri:uri,
    qs:options
  }, function(err,resp,body) {
    if (err) return cbk(err);
    var result;
    try {
      result = JSON.parse(body);
    } catch (err) {
      cbk(err);
      return;
    }
    cbk(null,result);
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Geocoding
geocoder.geocode("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.<span class="apidocCodeKeywordSpan">reverseGeocode</span>( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});

// Setting sensor to true
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
}, { sensor: true });
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.geocoder.yahoo" id="apidoc.module.geocoder.yahoo">module geocoder.yahoo</a></h1>


    <h2>
        <a href="#apidoc.element.geocoder.yahoo.geocode" id="apidoc.element.geocoder.yahoo.geocode">
        function <span class="apidocSignatureSpan">geocoder.yahoo.</span>geocode
        <span class="apidocSignatureSpan">( providerOpts, loc, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">geocode = function ( providerOpts, loc, cbk, opts ) {

  var options = _.extend({q: loc, flags: "J", appid:providerOpts.appid||"[yourappidhere]" }, opts || {});

  request({
    uri:"http://where.yahooapis.com/geocode",
    qs:options
  }, function(err,resp,body) {
    if (err) return cbk(err);
    var result;
    try {
      result = JSON.parse(body);
    } catch (err) {
      cbk(err);
      return;
    }
    cbk(null,result);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

###Example:

```javascript
var geocoder = require('geocoder');

// Geocoding
geocoder.<span class="apidocCodeKeywordSpan">geocode</span>("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.geocoder.yahoo.reverseGeocode" id="apidoc.element.geocoder.yahoo.reverseGeocode">
        function <span class="apidocSignatureSpan">geocoder.yahoo.</span>reverseGeocode
        <span class="apidocSignatureSpan">( providerOpts, lat, lng, cbk, opts )</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reverseGeocode = function ( providerOpts, lat, lng, cbk, opts ) {

  var options = _.extend({q: lat+", "+lng, gflags:"R", flags: "J", appid:providerOpts.appid||"[yourappidhere]" }, opts || {});

  request({
    uri:"http://where.yahooapis.com/geocode",
    qs:options
  }, function(err,resp,body) {

    // console.log("[GEOCODER Yahoo API] uri:", "http://where.yahooapis.com/geocode");
    // console.log("[GEOCODER Yahoo API] options:", JSON.stringify(options));
    // console.log("[GEOCODER Yahoo API] body:", body);

    if (err) return cbk(err);

    var result;
    try {
      result = JSON.parse(body);
    } catch (err) {
      cbk(err);
      return;
    }

    // Transform yahoo' structure into something that looks like Google's JSON outpu
    // https://developers.google.com/maps/documentation/geocoding/#JSON
    var googlejson = {
      "status":"OK",
      "results":[
        {
          "address_components":[],
          "formatted_address":"",
          "geometry":{
            "location":{
              "lat":lat,
              "lng":lng
            }
          }
        }
      ]
    };

    if (result.ResultSet.Error !== "0" &amp;&amp; result.ResultSet.Error !== 0) {
      console.log("[GEOCODER Yahoo API] ERROR", result.Error, result.ErrorMessage);
      return cbk(result.ResultSet.ErrorMessage);
    }

    var a = null;
    // Yahoo seems to change its response format "randomly". So, sometimes, it there is only one result,
    // it will be in ResultSet.Result, and sometimes, in ResultSet.Results[0]
    if (undefined !== result.ResultSet.Result) {
      a = result.ResultSet.Result;
    }
    else if (result.ResultSet.Results &amp;&amp; result.ResultSet.Results.length) {
      a = result.ResultSet.Results[0];
    }

    if (!a) {
      return cbk("Error getting results from Yahoo API");
    }

    if (a.house)
      googlejson.results[0].address_components.push({
        "long_name":a.house,
        "short_name":a.house,
        "types":["street_number"]
      });

    if (a.street)
      googlejson.results[0].address_components.push({
        "long_name":a.street,
        "short_name":a.street,
        "types":["route"]
      });

    if (a.city)
      googlejson.results[0].address_components.push({
        "long_name":a.city,
        "short_name":a.city,
        "types":["locality", "political"]
      });

    if (a.state)
      googlejson.results[0].address_components.push({
        "long_name":a.state,
        "short_name":a.statecode || a.state,
        "types":[ "administrative_area_level_1", "political" ]
      });

    if (a.county)
      googlejson.results[0].address_components.push({
        "long_name":a.county,
        "short_name":a.countycode || a.county,
        "types":[ "administrative_area_level_2", "political" ]
      });

    if (a.country)
      googlejson.results[0].address_components.push({
        "long_name":a.country,
        "short_name":a.countrycode,
        "types":[ "country" ]
      });

    if (a.postal)
      googlejson.results[0].address_components.push({
        "long_name":a.postal,
        "short_name":a.postal,
        "types":[ "postal_code" ]
      });

    if (a.latitude)
      googlejson.results[0].geometry.location = {
        "lat":parseFloat(a.latitude),
        "lng":parseFloat(a.longitude)
      };

    // Make a formatted address as well as we can
    var formatted = [];
    if (a.line1) formatted.push(a.line1);
    if (a.line2) formatted.push(a.line2);
    if (a.line3) formatted.push(a.line3);
    if (a.line4) formatted.push(a.line4);

    googlejson.results[0].formatted_address = formatted.join(", ");

    // console.log("[GEOCODER Yahoo API], calling callback w/", JSON.stringify(googlejson));

    cbk(null, googlejson);
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

// Geocoding
geocoder.geocode("Atlanta, GA", function ( err, data ) {
  // do something with data
});

// Reverse Geocoding
geocoder.<span class="apidocCodeKeywordSpan">reverseGeocode</span>( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
});

// Setting sensor to true
geocoder.reverseGeocode( 33.7489, -84.3789, function ( err, data ) {
  // do something with data
}, { sensor: true });
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>